---
kind: pipeline
type: docker
name: mail2clients

steps:
- name: build and test
  image: maven:3.6.3-jdk-11-openj9
  commands:
  - cd mail2clients
  - mvn compile
  - mvn test
  - mvn package

- name: build docker web image
  image: plugins/docker
  settings:
    dockerfile: Dockerfile_web
    repo: mcarras1/mail2clients
    username: 
        from_secret: DOCKER_USERNAME
    password:
        from_secret: DOCKER_PASSWORD
    auto_tag: true

- name: build docker database image
  image: plugins/docker
  settings:
    dockerfile: Dockerfile_database
    repo: mcarras1/mail2clientsdb
    username: 
        from_secret: DOCKER_USERNAME
    password:
        from_secret: DOCKER_PASSWORD
    auto_tag: true
